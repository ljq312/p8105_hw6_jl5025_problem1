---
title: "NYC restaurant dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(janitor)
library(stringr)
library(forcats)
library(viridis)
library(plotly)
library(readr)
library(dplyr)
library(tidytext)
library(shiny)
```

```{r}
### load data
nyc_inspections <- read_csv("./data/DOHMH_New_York_City_Restaurant_Inspection_Results.csv.gz", 
                           col_types = cols(building = col_character()),
                           na = c("NA", "N/A")) %>% 
  filter(grade %in% c("A", "B", "C"),
         boro != "Missing") %>% 
  mutate(boro = str_to_title(boro),
         inspection_num = row_number()) %>%
  select(inspection_num, boro, grade, score, critical_flag, dba, cuisine_description, zipcode, violation_description)
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}
bar_ggplot <- nyc_inspections %>% 
 # mutate(boro = fct_reorder(boro, score)) %>% 
  ggplot(aes(x = boro, fill = grade)) +
    geom_bar() +
    labs(title = "")
  
ggplotly(bar_ggplot)
```

Column {data-width=350}
-----------------------------------------------------------------------

### The summary of "score" for each boro

```{r}
nyc_inspections %>% 
  mutate(boro = fct_reorder(boro, score)) %>% 
  plot_ly(y =~ score, color =~ boro, type = "box", colors = "Set1")
```

### The number of "A"/"B"/"C" restaurants for each boro

```{r}
nyc_inspections %>% 
  group_by(boro, grade) %>% 
  summarize(n = n()) %>% 
  spread(key = grade, value = n) %>% 
  plot_ly( x = ~boro, y =~A, type = 'bar', name = 'A') %>% 
  add_trace(y =~B, name = "B") %>%
  add_trace(y =~C, name = "C") %>% 
  layout(yaxis = list(title = 'Count'), barmode = 'stack')
```

